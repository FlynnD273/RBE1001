// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// Left                 motor_group   9, 10           
// Right                motor_group   5, 3            
// Lift                 motor_group   11, 20          
// Controller1          controller                    
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// Left                 motor_group   9, 10           
// Right                motor_group   5, 3            
// Lift                 motor_group   11, 20          
// Controller1          controller                    
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// Left                 motor_group   9, 10           
// Right                motor_group   5, 3            
// Lift                 motor_group   11, 20          
// Controller1          controller                    
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// Left                 motor_group   9, 10           
// Right                motor_group   5, 3            
// Lift                 motor_group   11, 20          
// Controller1          controller                    
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// Left                 motor_group   9, 10           
// Right                motor_group   5, 3            
// Lift                 motor_group   11, 20          
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// Left                 motor_group   9, 10           
// Right                motor_group   5, 3            
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// Left                 motor_group   9, 10           
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// LiftL                motor         20              
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// LiftR                motor         11              
// LiftL                motor         20              
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// RB                   motor         3               
// LiftR                motor         11              
// LiftL                motor         20              
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// RF                   motor         5               
// RB                   motor         3               
// LiftR                motor         11              
// LiftL                motor         20              
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// LF                   motor         10              
// RF                   motor         5               
// RB                   motor         3               
// LiftR                motor         11              
// LiftL                motor         20              
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// ---- END VEXCODE CONFIGURED DEVICES ----
/*----------------------------------------------------------------------------*/
/*                                                                            */
/*    Module:       main.cpp                                                  */
/*    Author:       C:\Users\evanp                                            */
/*    Created:      Wed Jan 19 2022                                           */
/*    Description:  V5 project                                                */
/*                                                                            */
/*----------------------------------------------------------------------------*/

// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// LineTrackerA         line          A               
// LineTrackerB         line          B               
// LB                   motor         9               
// LF                   motor         10              
// RF                   motor         5               
// RB                   motor         3               
// LiftR                motor         11              
// LiftL                motor         20              
// Claw                 motor         4               
// Vision15             vision        15              
// RangeFinderE         sonar         E, F            
// ---- END VEXCODE CONFIGURED DEVICES ----

#include "vex.h"
#include <iostream>
#include <cmath>
using namespace std;

using namespace vex;

bool isLifterAuto = true;
int levelIndex = 0;
bool arrowPressed = false;
Toggler clawToggler = Toggler();

int main() 
{
  vexcodeInit();
  Left.spin(fwd);
  Right.spin(fwd);
  Lift.setStopping(hold);
  Claw.setStopping(hold);

  while (true)
  {
    double forward = Controller1.Axis2.position(percent);
    double turn = Controller1.Axis1.position(percent) / 3;

    Left.setVelocity(forward + turn, percent);
    Right.setVelocity(forward - turn, percent);

    if (!arrowPressed)
    {
      if (Controller1.ButtonUp.pressing() && levelIndex < LIFT_LEVEL_COUNT - 1)
      {
        arrowPressed = true;
        if (levelIndex < LIFT_LEVEL_COUNT - 1)
        {
          liftToFloor(++levelIndex);
        }
        else if (!isLifterAuto)
        {
          liftToFloor(levelIndex);
        }
        isLifterAuto = true;
      }
      else if (Controller1.ButtonDown.pressing())
      {
        arrowPressed = true;
        if (levelIndex > 0)
        {
          liftToFloor(--levelIndex);
        }
        else if (!isLifterAuto)
        {
          liftToFloor(levelIndex);
        }
        isLifterAuto = true;
      }
    }
    else if (!Controller1.ButtonDown.pressing() && !Controller1.ButtonUp.pressing())
    {
      arrowPressed = false;
    }

    if (clawToggler.getValue(Controller1.ButtonR1.pressing()))
    {
      // Claw.stop();
      // Claw.spin(fwd);
      // Claw.setVelocity(600, dps);
      Claw.rotateTo(100, degrees, 600, dps, false);
    }
    else
    {
      Claw.rotateTo(0, degrees, 600, dps, false);
    }

    if (abs(Controller1.Axis3.position(percent)) > 10 && isLifterAuto)
    {
      Lift.stop();
      Lift.spin(fwd);
      isLifterAuto = false;
    }

    if (!isLifterAuto)
    {
      Lift.setVelocity(Controller1.Axis3.position(percent) / 5, percent);

      if (levelIndex < LIFT_LEVEL_COUNT - 1 && LIFT_HEIGHTS[levelIndex + 1] < Lift.position(degrees))
      {
        levelIndex++;
      }
      else if (levelIndex > 0 && LIFT_HEIGHTS[levelIndex] > Lift.position(degrees))
      {
        levelIndex--;
      }
    }
    // Claw.setVelocity(Controller1.Axis4.position(percent) / 5, percent);

    // cout << "Claw: " << Claw.position(degrees) << "\n";
    // cout << levelIndex << "\n";
    // cout << "Lift: " << Lift.position(degrees) << "\n";
  }
}







